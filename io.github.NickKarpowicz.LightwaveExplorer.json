{
  "id": "io.github.NickKarpowicz.LightwaveExplorer",
  "runtime": "org.kde.Platform",
  "runtime-version": "6.10",
  "sdk": "org.kde.Sdk",
  "sdk-extensions": ["org.freedesktop.Sdk.Extension.llvm21"],
  "command": "flatpakLauncher.sh",
  "finish-args": [
    "--share=ipc",
    "--device=dri",
    "--socket=wayland",
    "--socket=fallback-x11"
  ],
  "cleanup": [
    "/include",
    "/lib/cmake",
    "/lib/pkgconfig",
    "/lib/*.la",
    "/lib/*.a",
    "/mkspecs",
    "/share/aclocal",
    "/share/info",
    "/share/man",
    "/opt"
  ],
  "modules": [
    {
      "name": "cuda",
      "buildsystem": "simple",
      "build-commands": [
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/libcufft",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_nvcc",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_cudart",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_crt",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_nvml_dev",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_cccl",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/libnvvm",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_nvrtc",
        "sh cuda_13.1.1_590.48.01_linux.run --tar xvf ./builds/cuda_culibos",
        "mkdir -p /app/opt/cuda",
        "cp -r -P builds/cuda_nvcc/* /app/opt/cuda",
        "cp -r -P builds/cuda_cudart/* /app/opt/cuda",
        "cp -r -P builds/cuda_crt/* /app/opt/cuda",
        "cp -r -P builds/cuda_nvml_dev/* /app/opt/cuda",
        "cp -r -P builds/cuda_cccl/* /app/opt/cuda",
        "cp -r -P builds/libcufft/* /app/opt/cuda",
        "cp -r -P builds/libnvvm/* /app/opt/cuda",
        "cp -r -P builds/cuda_nvrtc/* /app/opt/cuda",
        "cp -r -P builds/cuda_culibos/* /app/opt/cuda",
        "sed -i 's/rsqrt(double x);/rsqrt(double x) noexcept (true);/g' /app/opt/cuda/targets/x86_64-linux/include/crt/math_functions.h",
        "sed -i 's/rsqrtf(float x);/rsqrtf(float x) noexcept (true);/g' /app/opt/cuda/targets/x86_64-linux/include/crt/math_functions.h"
      ],
      "sources": [
        {
          "type": "file",
          "url": "https://developer.download.nvidia.com/compute/cuda/13.1.1/local_installers/cuda_13.1.1_590.48.01_linux.run",
          "sha256": "24ff323723722781436804b392a48f691cb40de9808095d3e2192d0db6dfb8e4"
        }
      ]
    },
    {
      "name": "gcem",
      "buildsystem": "cmake-ninja",
      "config-opts": ["-DCMAKE_POLICY_VERSION_MINIMUM=3.5"],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/kthohr/gcem",
          "tag": "v1.18.0",
          "commit": "012ae73c6d0a2cb09ffe86475f5c6fba3926e200"
        }
      ]
    },
    {
      "name": "dlib",
      "buildsystem": "simple",
      "build-commands": ["cp -R dlib /app/include/"],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/davisking/dlib",
          "tag": "v19.24.2",
          "commit": "39749fba5163d4e25030358f6aa8d91617bfdca2"
        }
      ]
    },
    {
      "name": "miniz",
      "buildsystem": "cmake-ninja",
      "config-opts": ["-DCMAKE_POLICY_VERSION_MINIMUM=3.5"],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/richgel999/miniz",
          "tag": "3.1.1",
          "commit": "d10b03cc73475af673df40f06e5cefd1d5f940d9"
        }
      ]
    },
    {
      "name": "tbb",
      "buildsystem": "cmake-ninja",
      "build-options": {
        "append-path": "/usr/lib/sdk/llvm21/bin",
        "prepend-ld-library-path": "/usr/lib/sdk/llvm21/lib"
      },
      "config-opts": [
        "-DCMAKE_POLICY_VERSION_MINIMUM=3.5",
        "-DCMAKE_CXX_COMPILER=clang++",
        "-DCMAKE_CXX_FLAGS='-O3 -march=x86-64-v3'"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/uxlfoundation/oneTBB",
          "tag": "v2022.3.0",
          "commit": "f1862f38f83568d96e814e469ab61f88336cc595"
        }
      ]
    },
    {
      "name": "LightwaveExplorer",
      "buildsystem": "cmake-ninja",
      "config-opts": [
        "-DFLATPAK=1",
        "-DCMAKE_CXX_COMPILER=g++",
        "-DCMAKE_CUDA_ARCHITECTURES='75;86;89;90;120'",
        "-DCUDAToolkit_ROOT=/app/opt/cuda",
        "-DCMAKE_CUDA_COMPILER=/app/opt/cuda/bin/nvcc",
        "-DCMAKE_CUDA_HOST_COMPILER=g++",
        "-DCMAKE_CXX_FLAGS='-O3 -march=x86-64-v3'"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/NickKarpowicz/LightwaveExplorer",
          "tag": "v2026.1.1",
          "commit": "36780c164bb46727da9cf627360b66fda393e241"
        }
      ]
    }
  ]
}
